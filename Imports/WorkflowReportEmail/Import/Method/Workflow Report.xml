<AML>
 <Item type="Method" id="6EB8989D346D4A019F7323BE328AB01E" action="add">
  <execution_allowed_to keyed_name="Administrators" type="Identity">2618D6F5A90949BAA7E920D1B04C7EE1</execution_allowed_to>
  <method_code><![CDATA[/* This method gets the Workflow Process of the context item and outputs HTML to 
   display the item's workflow signoff history. This method is based on the OOTB
   "Workflow History Report" method. It uses the OOTB "Workflow Process History"
   report to transform the AML result to the HTML table.
*/

Innovator inn = this.getInnovator();
string contextItemID = this.getID();

// Get the Workflow Process for the context item
Item workflow = inn.newItem("Workflow","get"); 
workflow.setProperty("source_id", contextItemID);
workflow.setAttribute("select", "state, name, related_id"); 

Item relatedProcess = workflow.createRelatedItem("Workflow Process","get"); 
relatedProcess.setAttribute("select", "id"); 
workflow = workflow.apply(); 

// Get the id of the workflow process
Item workflowProcess = workflow.getItemsByXPath("//Item[@type='Workflow Process']").getItemByIndex(0);
string workflowProcessID = workflowProcess.getID();

//Build and run query for report
Item qryItem = inn.newItem();
qryItem.loadAML(
        "<Item type=\"Workflow Process\" id=\"" + wfpID +
        "\" initial_action=\"get\" action=\"do_l10n\" select=\"active_date, closed_date, state, name, description, created_by_id\" >" +
        "<created_by_id>" +
        "<Item type=\"User\" select=\"first_name,last_name\" action=\"get\">" +
        "<Relationships>" +
        "<Item type=\"Alias\" action=\"get\" select=\"related_id(name)\"/>" +
        "</Relationships>" +
        "</Item>" +
        "</created_by_id>" +
        "<Relationships>" +
        "<Item type=\"Workflow Process Activity\" action=\"get\" select=\"related_id\">" +
        "<related_id>" +
        "<Item type=\"Activity\" action=\"get\" select=\"label,name,state,active_date\">" +
        "<and>" +
        "<state condition=\"ne\">Pending</state>" +
        "<or>" +
        "<is_start condition=\"ne\">1</is_start>" +
        "<is_auto condition=\"ne\">1</is_auto>" +
        "</or>" +
        "<or>" +
        "<is_end condition=\"ne\">1</is_end>" +
        "<is_auto condition=\"ne\">1</is_auto>" +
        "</or>" +
        "</and>" +
        "<Relationships>" +
        "<Item type=\"Activity Assignment\" action=\"get\" select=\"closed_by, is_disabled, closed_on, comments, path, related_id(name)\" >" +
        "<closed_by>" +
        "<Item type=\"User\" select=\"first_name,last_name\" action=\"get\">" +
        "<Relationships>" +
        "<Item type=\"Alias\" action=\"get\" select=\"related_id(name)\"/>" +
        "</Relationships>" +
        "</Item>" +
        "</closed_by>" +
        "</Item>" +
        "</Relationships>" +
        "</Item>" +
        "</related_id>" +
        "</Item>" +
        "</Relationships>" +
        "</Item>");
Item resultItem = qryItem.apply();

//Apply Report style sheet
Item report = inn.getItemByKeyedName("Report", "Workflow Process History");
string style = report.getProperty("xsl_stylesheet");
string html = resultItem.applyStylesheet(style, "text");
Item res = inn.newItem("Test Item");
res.setProperty("theHtml", html);
return res;
]]></method_code>
  <method_type>C#</method_type>
  <name>labs_GetWorkflowSignoffReport</name>
 </Item>
</AML>